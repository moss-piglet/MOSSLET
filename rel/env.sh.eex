#!/bin/sh

# configure node for distributed erlang with IPV6 support
export ERL_AFLAGS="-proto_dist inet6_tcp"
export ECTO_IPV6="true"
export DNS_CLUSTER_QUERY="${FLY_APP_NAME}.internal"
export RELEASE_DISTRIBUTION="name"
# Extract deployment ID: strip prefix up to last '-', then strip '@sha256:...' suffix
DEPLOYMENT_ID="${FLY_IMAGE_REF##*-}"
DEPLOYMENT_ID="${DEPLOYMENT_ID%%@*}"
export RELEASE_NODE="${FLY_APP_NAME}-${DEPLOYMENT_ID}@${FLY_PRIVATE_IP}"
